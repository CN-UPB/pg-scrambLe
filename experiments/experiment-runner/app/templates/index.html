<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<h1>System overview </h1>

<div>
        CPU utilization : amount of work handled by a CPU(all cores) example : No idle time if this metric shows 100%
        <div id="chart_cpu_util" style="width: 100%; height: 500px;"></div>
</div>

<div>
        System load : average number of processes over a given time. This metric can be used together with CPU usage. In
        netdata, three values of load average refer to the past one, five, and fifteen minutes of system operation
        <div id="chart_cpu_load" style="width: 100%; height: 500px;"></div>
</div>


<div>
        RAM : This tells how much of a computer's memory (RAM) is being used.
        <div id="chart_ram" style="width: 100%; height: 500px;"></div>
</div>

<div>
        Network bandwidth : display real-time data such as download and upload speeds. In netdata, only the bandwidth of
        physical network interfaces is aggregated.
        <div id="chart_net_band" style="width: 100%; height: 500px;"></div>
</div>

<div>
        Disk : rate of read/write operations on the disk.
        <div id="chart_net_disk" style="width: 100%; height: 500px;"></div>
</div>

<hr>

<h1>Docker services</h1>


{% for _name, _id in docker_list.items() %}

<h2>{{ _name }}</h2>

  <div>
      CPU usage for each microservice
      <div id="chart_docker_{{ _id }}_CPU" style="width: 100%; height: 500px;"></div>
  </div>

  <div>
        Disk : Throttle serviced I/O operations for each microservice
        <div id="chart_docker_{{ _id }}_Disk" style="width: 100%; height: 500px;"></div>
  </div>

  <div>
        Mem : Used Memory without Cache for each microservice
        <div id="chart_docker_{{ _id }}_Mem" style="width: 100%; height: 500px;"></div>
  </div>

<hr>

{% endfor %}

<script type="text/javascript">

google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawSystemCPUUtil);
google.charts.setOnLoadCallback(drawSystemCPULoad);
google.charts.setOnLoadCallback(drawSystemRAM);
google.charts.setOnLoadCallback(drawSystemNetworkBandwidth);
google.charts.setOnLoadCallback(drawSystemDisk);

{% for _name, _id in docker_list.items() %}

  google.charts.setOnLoadCallback(drawDocker{{ _id }}CPUUsage);
  google.charts.setOnLoadCallback(drawDocker{{ _id }}Disk);
  google.charts.setOnLoadCallback(drawDocker{{ _id }}Mem);

{% endfor %}


const urlParams = new URLSearchParams(window.location.search);
const host = urlParams.get('host');
const before = urlParams.get('before');
const after = urlParams.get('after');


function drawSystemCPUUtil() {

 	var query = new google.visualization.Query(`http://${host}:19999/api/v1/data?chart=system.cpu&after=${after}&before=${before}&format=datasource&options=nonzero`, {sendMethod: 'auto'});
  
  var chart_div = document.getElementById('chart_cpu_util')
  var chart = new google.visualization.AreaChart(chart_div);
  
  var options = {
    title: 'CPU Utilization',
    isStacked: 'absolute',
    vAxis: {minValue: 100}
  };
  
  
      google.visualization.events.addListener(chart, 'ready', function () {
        chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
      });
  
    query.send(function(data) {
        chart.draw(data.getDataTable(), options);
      });  


}

function drawSystemCPULoad() {
  var query = new google.visualization.Query(`http://${host}:19999/api/v1/data?chart=system.load&after=${after}&before=${before}&format=datasource&options=nonzero`, {sendMethod: 'auto'});
  
  var chart_div = document.getElementById('chart_cpu_load')
  var chart = new google.visualization.AreaChart(chart_div);

  var options = {
    title: 'CPU Load',
    isStacked: 'absolute'
  };
  
  google.visualization.events.addListener(chart, 'ready', function () {
    chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
  });

  query.send(function(data) {
      chart.draw(data.getDataTable(), options);
    });  

}

function drawSystemRAM() {
  var query = new google.visualization.Query(`http://${host}:19999/api/v1/data?chart=system.ram&format=datasource&points=500&after=${after}&before=${before}&options=nonzero%7Cpercentage`, {sendMethod: 'auto'});
  
  var chart_div = document.getElementById('chart_ram')
  var chart = new google.visualization.AreaChart(chart_div);

  var options = {
    title: 'RAM',
    isStacked: 'absolute'
  };
  
  google.visualization.events.addListener(chart, 'ready', function () {
    chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
  });

  query.send(function(data) {
      chart.draw(data.getDataTable(), options);
    });  
}

function drawSystemNetworkBandwidth() {
  var query = new google.visualization.Query(`http://${host}:19999/api/v1/data?chart=system.net&format=datasource&after=${after}&before=${before}&points=500&group=average&gtime=0&datasource&options=nonzeroseconds`, {sendMethod: 'auto'});
  
  var chart_div = document.getElementById('chart_net_band')
  var chart = new google.visualization.AreaChart(chart_div);

  var options = {
    title: 'Network Bandwidth',
    isStacked: 'absolute'
  };
  
  google.visualization.events.addListener(chart, 'ready', function () {
    chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
  });

  query.send(function(data) {
      chart.draw(data.getDataTable(), options);
    });  
}

function drawSystemDisk() {
  var query = new google.visualization.Query(`http://${host}:19999/api/v1/data?chart=system.io&format=datasource&after=${after}&before=${before}&points=500&group=average&gtime=0&datasource&options=nonzeroseconds`, {sendMethod: 'auto'});
  
  var chart_div = document.getElementById('chart_net_disk')
  var chart = new google.visualization.AreaChart(chart_div);

  var options = {
    title: 'Disk',
    isStacked: 'absolute'
  };
  
  google.visualization.events.addListener(chart, 'ready', function () {
    chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
  });

  query.send(function(data) {
      chart.draw(data.getDataTable(), options);
    });  
}

// Docker Services

{% for _name, _id in docker_list.items() %}

function drawDocker{{ _id }}CPUUsage() {
  var query = new google.visualization.Query(`http://${host}:19999/api/v1/data?chart=cgroup_{{ _name }}.cpu&format=datasource&after=${after}&before=${before}&points=500&group=average&gtime=0&datasource&options=nonzeroseconds`, {sendMethod: 'auto'});
  
  var chart_div = document.getElementById('chart_docker_{{ _id }}_CPU')
  var chart = new google.visualization.AreaChart(chart_div);

  var options = {
    title: 'CPU Usage',
    isStacked: 'absolute'
  };
  
  google.visualization.events.addListener(chart, 'ready', function () {
    chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
  });

  query.send(function(data) {
      chart.draw(data.getDataTable(), options);
    });  
}

function drawDocker{{ _id }}Disk() {
  var query = new google.visualization.Query(`http://${host}:19999/api/v1/data?chart=cgroup_{{ _name }}.mem&format=datasource&after=${after}&before=${before}&points=500&group=average&gtime=0&datasource&options=nonzeroseconds`, {sendMethod: 'auto'});
  
  var chart_div = document.getElementById('chart_docker_{{ _id }}_Disk')
  var chart = new google.visualization.AreaChart(chart_div);

  var options = {
    title: 'Disk',
    isStacked: 'absolute'
  };
  
  google.visualization.events.addListener(chart, 'ready', function () {
    chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
  });

  query.send(function(data) {
      chart.draw(data.getDataTable(), options);
    });  
}

function drawDocker{{ _id }}Mem() {
  var query = new google.visualization.Query(`http://${host}:19999/api/v1/data?chart=cgroup_{{ _name }}.throttle_io&format=datasource&after=${after}&before=${before}&points=500&group=average&gtime=0&datasource&options=nonzeroseconds`, {sendMethod: 'auto'});
  
  var chart_div = document.getElementById('chart_docker_{{ _id }}_Mem')
  var chart = new google.visualization.AreaChart(chart_div);

  var options = {
    title: 'Mem',
    isStacked: 'absolute'
  };
  
  google.visualization.events.addListener(chart, 'ready', function () {
    chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
  });

  query.send(function(data) {
      chart.draw(data.getDataTable(), options);
    });  
}


{% endfor %}




</script>